(function(a,i,g){a(function(){var b=new i;a.fn.colorselecter=function(){a(this).find("[data-role=collapsible]").collapsible();a(this).find("[data-role=fieldcontain]").fieldcontain();a(this).find("select").selectmenu();a(this).find("input").textinput()};a("#first #log-format").change(function(){if("custom"===a(this).val())a("#first #name-regexp, #first #drop-regexp").textinput("enable");else{a("#first #name-regexp, #first #drop-regexp").textinput("disable");a("#first #name-regexp").val(a(this).find("option:selected").data("name-regexp"));
a("#first #drop-regexp").val(a(this).find("option:selected").data("drop-regexp"))}});a("#first input").change(function(){b.init()});a("#first").bind("pageshow",function(){a(this).find("#log-format").trigger("change")});a("#second").bind("pagebeforeshow",function(){if(b.check()){a("#second #colourer_sets").html("");var c=a(a("#second #color_selecter").html().replace(/{id}/g,"time").replace(/{field}/g,"\u65f6\u95f4"));a(c).find("option[value=same]").remove();var f=a(a("#second #color_selecter").html().replace(/{id}/g,
"hide").replace(/{field}/g,"\u9690\u85cf"));a(f).find("option[value=same]").remove();a("#second #colourer_sets").append(c,f);b.regexp(a("#first #name-regexp").val(),a("#first #drop-regexp").val(),a("#first #hide-regexp").val()).parse(a("#first #log-text").val());a.each(b.names,function(e,d){var h=a(a("#second #color_selecter").html().replace(/{id}/g,"name_"+e).replace(/{field}/g,"\u540d\u5b57"));a(h).find("option[value=same]").remove();var j=a("#second #color_selecter").html().replace(/{id}/g,"said_"+
e).replace(/{field}/g,"\u8bf4\u8bdd"),k=a("#second #color_selecter").html().replace(/{id}/g,"done_"+e).replace(/{field}/g,"\u52a8\u4f5c"),l=a(a("#second #colourer_set").html().replace(/{id}/g,e).replace(/{name}/g,d));a(l).find("p").append(h,j,k);a("#second #colourer_sets").append(l)});a("#second #colourer_sets").colorselecter();a("#second #colourer_sets select").change(function(){var e=a("#"+a(this).attr("id").replace(/color_select_\S+_/g,"color_set_")),d=a("#"+a(this).attr("id").replace(/color_select/g,
"color")),h=a(this).val();if("custom"===h)d.textinput("enable");else if("same"===h){d.textinput("disable");d.val(e.find("input").first().val()).trigger("change")}else{d.textinput("disable");d.val(h).trigger("change")}});a("#second #colourer_sets input").change(function(){var e=a(this).attr("id"),d="#"+e.replace(/color_\S+_/g,"color_set_"),h=d+" .color_"+e.split("_")[1];a(h).css("color",a(this).val());-1!==e.indexOf("_name_")&&a(d).find("select").each(function(){-1===a(this).attr("id").indexOf("_name_")&&
a(this).trigger("change")})})}});a("#second").bind("pageshow",function(){a(this).find("select").trigger("change")});a("#third").bind("pagebeforeshow",function(){a("#second ").find("input").each(function(){var c=a(this).attr("id").split("_");c[2]===g?b.setColourer(c[1],b.getColourerFunc(a(this).val())):b.setNameColourer(c[2],c[1],b.getColourerFunc(a(this).val()))});a("#log-output").val(b.output())})})})(jQuery,function(a,i){String.prototype.toRegExp=function(){return RegExp(this.replace(/^~\^(.*)~S$/,
"^$1"))};var g=function(){this.init()};g.prototype.check=function(){return this.changed};g.prototype.init=function(){this.rows=[];this.names=[];this.namescolourers=[];this.colourers=[];this.output_rows=[];this.prev_color="";this.changed=true;return this};g.prototype.regexp=function(b,c,f){this.name_regexp=b.toRegExp();this.drop_regexp=c.toRegExp();this.hide_regexp=f.toRegExp();return this};g.prototype.parse=function(b){var c=this;b=b.replace(/(?:\x0f|\x1f|\x02|\x03)(?:\d{1,2}(?:,\d{1,2})?)?/g,"");
a.each(b.split("\n"),function(f,e){if(false===c.drop_regexp.test(e)){var d=c.name_regexp.exec(e);if(null!==d){alert(d);var h=(d[2]||d[3]||d[4]).split("|")[0];-1===c.names.indexOf(h)&&c.names.push(h);var j=d[3]!==""?"done":"said",k=e.replace(d[0],"");if(c.hide_regexp.test(k))j="hide";c.output_rows.push([h,j,d[1],d[0].replace(d[1],""),k])}}});this.changed=false;return this};g.prototype.names=function(){return this.names};g.prototype.getColourerFunc=function(b){return function(c,f){var e="";if(f!==b){if(""!==
f)e="[/color]";if(""!==b)c="[color="+b+"]"+c}return[e+c,b]}};g.prototype.setColourer=function(b,c){this.colourers[b]=c;return this};g.prototype.setNameColourer=function(b,c,f){if(i===this.namescolourers[b])this.namescolourers[b]=[];this.namescolourers[b][c]=f;return this};g.prototype.callNameColourer=function(b,c,f){b=c==="hide"||c==="time"?this.colourers[c]:this.namescolourers[b][c];if(i!==b){b=b(f,this.prev_color);f=b[0];this.prev_color=b[1]}return f};g.prototype.output=function(){var b="",c=this;
a.each(this.output_rows,function(f,e){var d=c.names.indexOf(e[0]);b=b+c.callNameColourer(d,"time",e[2])+c.callNameColourer(d,"name",e[3])+c.callNameColourer(d,e[1],e[4])+"\n"});if(""!==this.prev_color)b+="[/color]";return b.replace(/\n\[\/color\]/g,"[/color]\n")};return g}(jQuery));
