(function(a,i,g){a(function(){var b=new i;a.fn.colorselecter=function(){a(this).find("[data-role=collapsible]").collapsible();a(this).find("[data-role=fieldcontain]").fieldcontain();a(this).find("select").selectmenu();a(this).find("input").textinput()};a("#first #log-format").change(function(){if("custom"===a(this).val())a("#first #name-regexp, #first #drop-regexp").textinput("enable");else{a("#first #name-regexp, #first #drop-regexp").textinput("disable");a("#first #name-regexp").val(a(this).find("option:selected").data("name-regexp"));
a("#first #drop-regexp").val(a(this).find("option:selected").data("drop-regexp"))}});a("#first input").change(function(){b.init()});a("#first").bind("pageshow",function(){a(this).find("#log-format").trigger("change")});a("#second").bind("pagebeforeshow",function(){if(b.check()){a("#second #colourer_sets").html("");var c=a(a("#second #color_selecter").html().replace(/{id}/g,"time").replace(/{field}/g,"\u65f6\u95f4"));a(c).find("option[value=same]").remove();var f=a(a("#second #color_selecter").html().replace(/{id}/g,
"hide").replace(/{field}/g,"\u9690\u85cf"));a(f).find("option[value=same]").remove();a("#second #colourer_sets").append(c,f);b.regexp(a("#first #name-regexp").val(),a("#first #drop-regexp").val(),a("#first #hide-regexp").val()).parse(a("#first #log-text").val());a.each(b.names,function(d,e){var h=a(a("#second #color_selecter").html().replace(/{id}/g,"name_"+d).replace(/{field}/g,"\u540d\u5b57"));a(h).find("option[value=same]").remove();var j=a("#second #color_selecter").html().replace(/{id}/g,"said_"+
d).replace(/{field}/g,"\u8bf4\u8bdd"),k=a("#second #color_selecter").html().replace(/{id}/g,"done_"+d).replace(/{field}/g,"\u52a8\u4f5c"),l=a(a("#second #colourer_set").html().replace(/{id}/g,d).replace(/{name}/g,e));a(l).find("p").append(h,j,k);a("#second #colourer_sets").append(l)});a("#second #colourer_sets").colorselecter();a("#second #colourer_sets select").change(function(){var d=a("#"+a(this).attr("id").replace(/color_select_\S+_/g,"color_set_")),e=a("#"+a(this).attr("id").replace(/color_select/g,
"color")),h=a(this).val();if("custom"===h)e.textinput("enable");else if("same"===h){e.textinput("disable");e.val(d.find("input").first().val()).trigger("change")}else{e.textinput("disable");e.val(h).trigger("change")}});a("#second #colourer_sets input").change(function(){var d=a(this).attr("id"),e="#"+d.replace(/color_\S+_/g,"color_set_"),h=e+" .color_"+d.split("_")[1];a(h).css("color",a(this).val());-1!==d.indexOf("_name_")&&a(e).find("select").each(function(){-1===a(this).attr("id").indexOf("_name_")&&
a(this).trigger("change")})})}});a("#second").bind("pageshow",function(){a(this).find("select").trigger("change")});a("#third").bind("pagebeforeshow",function(){a("#second ").find("input").each(function(){var c=a(this).attr("id").split("_");c[2]===g?b.setColourer(c[1],b.getColourerFunc(a(this).val())):b.setNameColourer(c[2],c[1],b.getColourerFunc(a(this).val()))});a("#log-output").val(b.output())})})})(jQuery,function(a,i){String.prototype.toRegExp=function(){return RegExp(this.replace(/^~\^(.*)~S$/,
"^$1"))};var g=function(){this.init()};g.prototype.check=function(){return this.changed};g.prototype.init=function(){this.rows=[];this.names=[];this.namescolourers=[];this.colourers=[];this.output_rows=[];this.prev_color="";this.changed=true;return this};g.prototype.regexp=function(b,c,f){this.name_regexp=b.toRegExp();this.drop_regexp=c.toRegExp();this.hide_regexp=f.toRegExp();return this};g.prototype.parse=function(b){var c=this;a.each(b.split("\n"),function(f,d){if(false===c.drop_regexp.test(d)){var e=
c.name_regexp.exec(d);if(null!==e){var h=(e[2]||e[3]).split("|")[0];-1===c.names.indexOf(h)&&c.names.push(h);var j=e[2]===i?"done":"said",k=d.replace(e[0],"");if(c.hide_regexp.test(k))j="hide";c.output_rows.push([h,j,e[1],e[0].replace(e[1],""),k])}}});this.changed=false;return this};g.prototype.names=function(){return this.names};g.prototype.getColourerFunc=function(b){return function(c,f){var d="";if(f!==b){if(""!==f)d="[/color]";if(""!==b)c="[color="+b+"]"+c}return[d+c,b]}};g.prototype.setColourer=
function(b,c){this.colourers[b]=c;return this};g.prototype.setNameColourer=function(b,c,f){if(i===this.namescolourers[b])this.namescolourers[b]=[];this.namescolourers[b][c]=f;return this};g.prototype.callNameColourer=function(b,c,f){b=c==="hide"||c==="time"?this.colourers[c]:this.namescolourers[b][c];if(i!==b){b=b(f,this.prev_color);f=b[0];this.prev_color=b[1]}return f};g.prototype.output=function(){var b="",c=this;a.each(this.output_rows,function(f,d){var e=c.names.indexOf(d[0]);b=b+c.callNameColourer(e,
"time",d[2])+c.callNameColourer(e,"name",d[3])+c.callNameColourer(e,d[1],d[4])+"\n"});if(""!==this.prev_color)b+="[/color]";return b.replace(/\n\[\/color\]/g,"[/color]\n")};return g}(jQuery));
